<link rel="import" href="/components/polymer/polymer.html">
<link rel="import" href="/components/voice-elements/dist/voice-player.html">
<link rel="import" href="/components/core-overlay/core-overlay.html">

<polymer-element name="comments-entry" attribute="commentToPost">
    <template>
        <style>
        label {
            display: block;
        }
        textarea {
            display: block;
        }
		div.modalBody {
			background-color: white;
			padding: 20px;
			border-radius: 4px;
		}
        </style>
        <form on-submit="{{ submitMe }}">
            <label>Email <input type="email" name="email" placeholder="john@doe.me" value="{{ email }}"></label>
            <textarea name="text" placeholder="Enter Comment" value="{{ text }}"></textarea>
            <input type="submit" value="Submit">
        </form>
        <core-overlay backdrop=true id="areYouSureOverlay">
            <voice-player id="areYouSureEr" text="{{ text }}"></voice-player>
			<div class="modalBody">
				<p>Are you <strong>sure</strong> you want to post this?</p>
				<template if="{{ hasBeenHarassed }}">
					<div horizontal layout>
						<button flex core-overlay-toggle>Cancel</button>
						<button flex core-overlay-toggle on-click="{{ actuallySubmit }}">Submit</button>
					</div>
				</template>
			</div>
        </core-overlay>
    </template>
    <script>
        Polymer({
			ready: function () {
				var hasListened = function () {
					this.hasBeenHarassed = true;
				};
			
				this.$.areYouSureEr.addEventListener('end', hasListened.bind(this));
			},
            commentToPost: {},
			hasBeenHarassed: false,
            submitMe: function (evt, detail, sender) {
                evt.preventDefault();
                evt.stopPropagation();
				
				this.hasBeenHarassed = false;
                
                this.$.areYouSureOverlay.open();
                this.$.areYouSureEr.speak();
                
                
            },
            actuallySubmit: function (evt, detail, sender) {
                this.fire('newComment', {
                    text: this.text,
                    date: new Date(),
                    email: this.email,
					likes: 0
                });
                this.text = '';
                this.email = '';
            }
        });
    </script>
</polymer-element>
